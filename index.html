<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CeriaPoints</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="initialLoader" class="initial-loader">
      <div class="spinner"></div>
      <h2 style="color: var(--primary-color)">Loading CeriaPoints...</h2>
    </div>

    <div id="authContainer" class="auth-wrapper" style="display: none">
      <div class="auth-left">
        <img
          src="pictures/tmc-logo.png"
          alt="Tadika Matahari Ceria Logo"
          class="brand-logo"
        />
        <h1 class="brand-title">CeriaPoints</h1>
        <div class="feature-box">
          <div class="feature-item">
            <div class="feature-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 6.91 14.14 2 9.27 8.91 8.26 12 2"
                ></polygon>
              </svg>
            </div>
            <div class="feature-text">
              <h3>Earn Points</h3>
              <p>Recycle materials to collect Points.</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
              </svg>
            </div>
            <div class="feature-text">
              <h3>View Leaderboard</h3>
              <p>Track your real-world impact and rank.</p>
            </div>
          </div>
          <div class="feature-item">
            <div class="feature-icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="20 12 20 22 4 22 4 12"></polyline>
                <rect x="2" y="7" width="20" height="5"></rect>
                <line x1="12" y1="22" x2="12" y2="7"></line>
                <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
                <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
              </svg>
            </div>
            <div class="feature-text">
              <h3>Win Prizes</h3>
              <p>Finish in the top 3 to earn exclusive rewards!</p>
            </div>
          </div>
        </div>
      </div>

      <div class="auth-right">
        <form
          id="loginForm"
          onsubmit="
            event.preventDefault();
            loginUser();
          "
        >
          <h2>Welcome Back</h2>
          <p class="form-subtext">Sign in to your CeriaPoints account.</p>
          <label for="loginEmail">Email Address</label>
          <input
            type="email"
            id="loginEmail"
            placeholder="Enter your email"
            required
          />
          <label for="loginPassword">Password</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="loginPassword"
              placeholder="Enter your password"
              required
            />
            <button
              type="button"
              class="toggle-password"
              onclick="togglePassword('loginPassword', this)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>

          <button type="submit" class="action-btn">Sign In</button>
          <div class="auth-links">
            <p class="toggle-text" onclick="toggleAuthView('forgot')">
              Forgot Password?
            </p>
            <p class="toggle-text" onclick="toggleAuthView('register')">
              Need an account? Register here.
            </p>
          </div>
        </form>

        <form
          id="forgotForm"
          onsubmit="
            event.preventDefault();
            resetPassword();
          "
          style="display: none"
        >
          <h2>Reset Password</h2>
          <p class="form-subtext">We'll send a recovery link to your email.</p>
          <label for="resetEmail">Email Address</label>
          <input
            type="email"
            id="resetEmail"
            placeholder="Enter your email"
            required
          />
          <button type="submit" class="action-btn">Send Reset Link</button>
          <div class="auth-links">
            <p class="toggle-text" onclick="toggleAuthView('login')">
              Back to Sign In
            </p>
          </div>
        </form>

        <form
          id="registerForm"
          onsubmit="
            event.preventDefault();
            registerUser();
          "
          style="display: none"
        >
          <h2>Create Account</h2>
          <p class="form-subtext">Join our community recycling program.</p>
          <label for="regName">Full Name</label>
          <input
            type="text"
            id="regName"
            placeholder="Enter your full name..."
            required
          />
          <label for="regEmail">Email Address</label>
          <input
            type="email"
            id="regEmail"
            placeholder="Enter your email..."
            required
          />
          <label for="regPassword">Password</label>
          <div class="password-wrapper">
            <input
              type="password"
              id="regPassword"
              placeholder="Enter your password..."
              required
              minlength="6"
            />
            <button
              type="button"
              class="toggle-password"
              onclick="togglePassword('regPassword', this)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>

          <button type="submit" class="action-btn">Register</button>
          <div class="auth-links">
            <p class="toggle-text" onclick="toggleAuthView('login')">
              Already have an account? Sign in.
            </p>
          </div>
        </form>
      </div>
    </div>

    <div id="appContainer" class="app-container">
      <div class="app-header-wrapper">
        <div class="app-header">
          <div class="header-brand">
            <img
              src="pictures/tmc-logo.png"
              alt="CeriaPoints Logo"
              class="header-logo"
            />
            <h1 class="logo">CeriaPoints</h1>
          </div>
          <button class="logout-btn" onclick="logoutUser()">Log Out</button>
        </div>
        <div class="nav-buttons">
          <button
            class="nav-btn active"
            id="navUser"
            onclick="switchRole('userPage')"
          >
            My Impact
          </button>
          <button
            class="nav-btn"
            id="navWeigher"
            onclick="switchRole('weigherPage')"
          >
            Weigher Terminal
          </button>
          <button
            class="nav-btn"
            id="navAdmin"
            onclick="switchRole('adminPage')"
          >
            Admin Panel
          </button>
          <button
            class="nav-btn"
            id="navProfile"
            onclick="switchRole('profilePage')"
          >
            Profile Settings
          </button>
        </div>
      </div>

      <div class="app-content">
        <div id="userPage" class="page" style="display: none">
          <div class="card main-points-card">
            <p class="greeting">
              Welcome, <strong id="displayUserName">User</strong>
            </p>
            <h1 class="points-display">
              <span id="userPointsDisplay">0</span>
            </h1>
            <p class="subtitle">Total Points</p>
          </div>

          <h3 class="section-title">Lifetime Real-World Impact</h3>
          <div class="impact-grid">
            <div class="card impact-card tree-card">
              <svg
                class="impact-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                fill="none"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M12 10a6 6 0 0 0 -6 -6h-3v2a6 6 0 0 0 6 6h3" />
                <path d="M12 14a6 6 0 0 1 6 -6h3v1a6 6 0 0 1 -6 6h-3" />
                <path d="M12 20v-10" />
              </svg>
              <div id="treesSaved" class="impact-number">0.0</div>
              <div class="impact-label">Trees Saved</div>
            </div>

            <div class="card impact-card co2-card">
              <svg
                class="impact-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                fill="none"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path
                  d="M6.657 18c-2.572 0 -4.657 -2.007 -4.657 -4.483c0 -2.475 2.085 -4.482 4.657 -4.482c.393 -1.762 1.794 -3.2 3.675 -3.773c1.88 -.572 3.956 -.193 5.444 1c1.488 1.19 2.162 3.007 1.77 4.769h.99c1.913 0 3.464 1.56 3.464 3.486c0 1.927 -1.55 3.487 -3.465 3.487h-11.878"
                />
              </svg>
              <div id="co2Saved" class="impact-number">0.0</div>
              <div class="impact-label">Kg CO2 Prevented</div>
            </div>

            <div class="card impact-card energy-card">
              <svg
                class="impact-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                fill="none"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11" />
              </svg>
              <div id="energySaved" class="impact-number">0.0</div>
              <div class="impact-label">kWh Energy Saved</div>
            </div>
          </div>

          <div class="card leaderboard-card">
            <h3
              style="
                margin-top: 0;
                margin-bottom: 15px;
                color: var(--text-main);
                display: flex;
                align-items: center;
                justify-content: space-between;
              "
            >
              <span>Top Recyclers</span>

              <select
                id="leaderboardYear"
                onchange="fetchLeaderboard()"
                style="
                  width: auto;
                  padding: 6px 12px;
                  margin-left: auto;
                  margin-right: 15px;
                  border-radius: 20px;
                  font-weight: bold;
                  color: var(--primary-color);
                "
              >
                <option value="current">2026 (Current)</option>
              </select>

              <svg
                class="trophy-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M8 21h8" />
                <path d="M12 17v4" />
                <path d="M7 4h10v4a5 5 0 0 1-10 0V4Z" />
                <path d="M7 4H4.5a1.5 1.5 0 0 0 0 3H7" />
                <path d="M17 4h2.5a1.5 1.5 0 0 1 0 3H17" />
              </svg>
            </h3>
            <div id="leaderboardList">
              <p style="text-align: center; color: var(--text-muted)">
                Loading leaderboard...
              </p>
            </div>
          </div>
        </div>

        <div id="weigherPage" class="page" style="display: none">
          <div class="weigher-header">
            <h2
              style="
                font-size: 2em;
                margin-bottom: 5px;
                color: var(--primary-color);
              "
            >
              Weigher Terminal
            </h2>
            <p
              style="
                color: var(--text-muted);
                font-size: 1.1em;
                margin-bottom: 20px;
              "
            >
              Follow the steps below to award points.
            </p>
          </div>

          <div class="card weigher-card">
            <h3 class="step-title">
              <span class="step-badge">1</span> Find User
            </h3>
            <label for="liveSearchInput" class="large-label"
              >Search by Name:</label
            >
            <div class="search-container">
              <input
                type="text"
                id="liveSearchInput"
                class="large-input"
                placeholder="Start typing a name..."
                autocomplete="off"
              />
              <div
                id="searchResultsDropdown"
                class="dropdown-list large-dropdown"
              ></div>
            </div>
            <div id="searchResult" class="search-result"></div>

            <hr class="divider" style="margin: 30px 0" />

            <form
              id="weighingForm"
              onsubmit="
                event.preventDefault();
                processWeighIn();
              "
              style="display: none"
            >
              <h3 class="step-title">
                <span class="step-badge">2</span> Weigh Items
              </h3>

              <label for="materialSelect" class="large-label"
                >Material Type:</label
              >
              <select id="materialSelect" class="large-input"></select>

              <label for="weightInput" class="large-label"
                >Total Weight (in KG):</label
              >
              <input
                type="number"
                id="weightInput"
                class="large-input highlight-input"
                placeholder="0.00"
                min="0.01"
                step="0.01"
                required
              />

              <button type="submit" class="action-btn large-btn">
                Award Points Now
              </button>
            </form>
          </div>
        </div>

        <div id="adminPage" class="page" style="display: none">
          <h2>Admin Panel</h2>

          <div class="card" style="text-align: left">
            <h3 style="margin-top: 0; margin-bottom: 20px">Rate Management</h3>

            <div class="security-form">
              <h4 class="form-section-title">Live Material Rates</h4>
              <p class="form-subtext" style="margin-bottom: 15px">
                Edit points awarded and environmental multipliers. Changes sync
                instantly.
              </p>
              <div id="adminRatesList"></div>
            </div>

            <div class="security-form" style="margin-top: 20px">
              <h4 class="form-section-title">Add Material</h4>
              <p class="form-subtext" style="margin-bottom: 15px">
                Register a new material, select its environmental impact
                category, and set the multiplier per KG.
              </p>

              <div class="admin-add-row">
                <input
                  type="text"
                  id="newMaterialName"
                  placeholder="Name (e.g. Glass)"
                  required
                />
                <input
                  type="number"
                  id="newMaterialRate"
                  placeholder="Pts/KG"
                  min="1"
                  required
                />

                <select id="newMaterialImpact" required>
                  <option value="" disabled selected>Select Impact</option>
                  <option value="trees">Trees Saved</option>
                  <option value="co2">CO2 Prevented (kg)</option>
                  <option value="energy">Energy Saved (kWh)</option>
                </select>

                <input
                  type="number"
                  id="newMaterialMultiplier"
                  placeholder="Mult. (e.g. 1.5)"
                  step="0.001"
                  min="0"
                  required
                />
                <button
                  class="action-btn"
                  style="margin-top: 0"
                  onclick="addNewMaterial()"
                >
                  Add
                </button>
              </div>
            </div>
          </div>

          <div class="card" style="text-align: left">
            <h3 style="margin-top: 0; margin-bottom: 20px">Season & History</h3>
            <div class="security-form">
              <h4 class="form-section-title">Annual Reset</h4>
              <p class="form-subtext" style="margin-bottom: 12px">
                End the current year's season. This archives all current points
                to historical data and resets everyone to zero for the new year.
              </p>
              <button
                class="outline-btn small-btn"
                onclick="
                  showToast(
                    'Season reset disabled for current active term.',
                    'info',
                  )
                "
              >
                Archive 2026 Season
              </button>
            </div>
          </div>
        </div>

        <div id="profilePage" class="page" style="display: none">
          <h2>Profile Settings</h2>
          <div class="card profile-header">
            <div class="avatar-wrapper">
              <img
                id="currentAvatar"
                src="https://ui-avatars.com/api/?name=User&background=fada67&color=3c78d8"
                alt="Profile Picture"
              />
            </div>
            <h3 id="profileName" class="profile-name">User Name</h3>
            <input
              type="file"
              id="avatarUpload"
              accept="image/*"
              class="hidden-file-input"
              onchange="uploadProfilePicture()"
            />
            <label for="avatarUpload" class="upload-btn">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
              Upload New Photo
            </label>
          </div>

          <div class="card" style="text-align: left">
            <h3 style="margin-top: 0; margin-bottom: 20px">
              Security Settings
            </h3>

            <form
              onsubmit="
                event.preventDefault();
                updateUserEmail();
              "
              class="security-form"
            >
              <h4 class="form-section-title">Email Address</h4>
              <p class="form-subtext" style="margin-bottom: 12px">
                Update your account's login email.
              </p>

              <label for="currentEmailDisplay">Current Email</label>
              <input
                type="email"
                id="currentEmailDisplay"
                disabled
                class="disabled-input"
              />

              <label for="newEmailInput" style="margin-top: 15px"
                >New Email</label
              >
              <input
                type="email"
                id="newEmailInput"
                placeholder="Enter new email address"
                required
              />

              <label for="emailCurrentPassword" style="margin-top: 15px"
                >Current Password</label
              >
              <div class="password-wrapper">
                <input
                  type="password"
                  id="emailCurrentPassword"
                  placeholder="Verify your current password"
                  required
                />
                <button
                  type="button"
                  class="toggle-password"
                  onclick="togglePassword('emailCurrentPassword', this)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>

              <button
                type="submit"
                class="action-btn small-btn"
                style="margin-top: 20px"
              >
                Save New Email
              </button>
            </form>

            <form
              onsubmit="
                event.preventDefault();
                updateUserPassword();
              "
              class="security-form"
              style="margin-top: 20px"
            >
              <h4 class="form-section-title">Change Password</h4>
              <p class="form-subtext" style="margin-bottom: 12px">
                Please verify your current password to change it.
              </p>

              <label for="currentPassword">Current Password</label>
              <div class="password-wrapper">
                <input
                  type="password"
                  id="currentPassword"
                  placeholder="Enter your current password"
                  required
                />
                <button
                  type="button"
                  class="toggle-password"
                  onclick="togglePassword('currentPassword', this)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>

              <label for="newPasswordInput" style="margin-top: 15px"
                >New Password</label
              >
              <div class="password-wrapper">
                <input
                  type="password"
                  id="newPasswordInput"
                  placeholder="Min 6 characters"
                  required
                  minlength="6"
                />
                <button
                  type="button"
                  class="toggle-password"
                  onclick="togglePassword('newPasswordInput', this)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>

              <button
                type="submit"
                class="action-btn small-btn"
                style="margin-top: 20px"
              >
                Update Password
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div id="logoutModal" class="modal-overlay" style="display: none">
      <div class="card modal-card">
        <h3 style="margin-top: 0; color: var(--primary-color)">Log Out</h3>
        <p style="color: var(--text-muted); margin-bottom: 25px">
          Are you sure you want to log out of CeriaPoints?
        </p>
        <div style="display: flex; gap: 15px">
          <button
            class="outline-btn"
            style="width: 50%; margin: 0; padding: 12px"
            onclick="closeLogoutModal()"
          >
            Cancel
          </button>
          <button
            class="action-btn"
            style="
              width: 50%;
              margin: 0;
              padding: 12px;
              background-color: var(--error-color);
              color: white;
              box-shadow: 0 4px 6px rgba(231, 76, 60, 0.3);
            "
            onclick="confirmLogout()"
          >
            Log Out
          </button>
        </div>
      </div>
    </div>

    <div id="customToast" class="toast"></div>
    <script type="module" src="script.js"></script>
  </body>
</html>
